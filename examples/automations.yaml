# Automation examples for Shelly Scripts Backup

# Daily backup at 2:00 AM
- alias: "Shelly Scripts - Daily Backup"
  description: "Daily backup of Shelly scripts"
  trigger:
    - platform: time
      at: "02:00:00"
  action:
    - service: advanced_shelly.backup_now
    - service: notify.persistent_notification
      data:
        title: "Shelly Backup"
        message: "Shelly scripts backup completed"

# Backup on Home Assistant restart
- alias: "Shelly Scripts - Backup on HA Restart"
  description: "Create a script backup on Home Assistant restart"
  trigger:
    - platform: homeassistant
      event: start
  action:
    - delay: "00:01:00"  # Wait a minute after startup
    - service: advanced_shelly.backup_now

# Backup a specific device
- alias: "Shelly Scripts - Backup Specific Device"
  description: "Backup scripts for a specific device"
  trigger:
    - platform: state
      entity_id: input_boolean.backup_shelly_trigger
      to: "on"
  action:
    - service: advanced_shelly.backup_now
      data:
        device_id: "shellyplus1pm-a8032ab12345"
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.backup_shelly_trigger

# Telegram notification after backup
- alias: "Shelly Scripts - Telegram Notification"
  description: "Send a Telegram notification after backup"
  trigger:
    - platform: time
      at: "03:00:00"
  action:
    - service: advanced_shelly.backup_now
    - service: notify.telegram
      data:
        message: "ðŸ”’ Shelly scripts backup completed successfully"

# Weekly backup with archive
- alias: "Shelly Scripts - Weekly Backup with Archive"
  description: "Weekly backup with archive creation"
  trigger:
    - platform: time
      at: "01:00:00"
  condition:
    - condition: time
      weekday:
        - sun
  action:
    - service: advanced_shelly.backup_now
    - service: shell_command.archive_shelly_backups

# Restore script (manual trigger example)
- alias: "Shelly Scripts - Restore Script Example"
  description: "Example script restore"
  trigger:
    - platform: state
      entity_id: input_boolean.restore_shelly_script
      to: "on"
  action:
    - service: advanced_shelly.restore_script
      data:
        device_id: "shellyplus1pm-a8032ab12345"
        script_id: 1
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.restore_shelly_script
    - service: notify.persistent_notification
      data:
        title: "Shelly Restore"
        message: "Script restored from backup"

# Shell command for archiving (add to configuration.yaml)
# shell_command:
#   archive_shelly_backups: >
#     tar -czf /config/backups/shelly_scripts_$(date +%Y%m%d).tar.gz
#     -C /config shelly_backups

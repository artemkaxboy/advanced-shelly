# ÐŸÑ€Ð¸Ð¼ÐµÑ€Ñ‹ Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ð·Ð°Ñ†Ð¸Ð¹ Ð´Ð»Ñ Shelly Scripts Backup

# Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ñ‹Ð¹ Ð±ÑÐºÐ°Ð¿ Ð² 2 Ñ‡Ð°ÑÐ° Ð½Ð¾Ñ‡Ð¸
- alias: "Shelly Scripts - Daily Backup"
  description: "Ð•Ð¶ÐµÐ´Ð½ÐµÐ²Ð½Ð¾Ðµ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½Ð¾Ðµ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² Shelly"
  trigger:
    - platform: time
      at: "02:00:00"
  action:
    - service: shelly_scripts_backup.backup_now
    - service: notify.persistent_notification
      data:
        title: "Shelly Backup"
        message: "Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð¾Ðµ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² Shelly Ð·Ð°Ð²ÐµÑ€ÑˆÐµÐ½Ð¾"

# Ð‘ÑÐºÐ°Ð¿ Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐµ Home Assistant
- alias: "Shelly Scripts - Backup on HA Restart"
  description: "Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð±ÑÐºÐ°Ð¿Ð° ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² Ð¿Ñ€Ð¸ Ð¿ÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐºÐµ Home Assistant"
  trigger:
    - platform: homeassistant
      event: start
  action:
    - delay: "00:01:00"  # ÐŸÐ¾Ð´Ð¾Ð¶Ð´Ð°Ñ‚ÑŒ Ð¼Ð¸Ð½ÑƒÑ‚Ñƒ Ð¿Ð¾ÑÐ»Ðµ ÑÑ‚Ð°Ñ€Ñ‚Ð°
    - service: shelly_scripts_backup.backup_now

# Ð‘ÑÐºÐ°Ð¿ ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°
- alias: "Shelly Scripts - Backup Specific Device"
  description: "Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð¾Ðµ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² ÐºÐ¾Ð½ÐºÑ€ÐµÑ‚Ð½Ð¾Ð³Ð¾ ÑƒÑÑ‚Ñ€Ð¾Ð¹ÑÑ‚Ð²Ð°"
  trigger:
    - platform: state
      entity_id: input_boolean.backup_shelly_trigger
      to: "on"
  action:
    - service: shelly_scripts_backup.backup_now
      data:
        device_id: "shellyplus1pm-a8032ab12345"
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.backup_shelly_trigger

# Ð£Ð²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ðµ Ð² Telegram Ð¿Ð¾ÑÐ»Ðµ Ð±ÑÐºÐ°Ð¿Ð°
- alias: "Shelly Scripts - Telegram Notification"
  description: "ÐžÑ‚Ð¿Ñ€Ð°Ð²ÐºÐ° ÑƒÐ²ÐµÐ´Ð¾Ð¼Ð»ÐµÐ½Ð¸Ñ Ð² Telegram Ð¿Ð¾ÑÐ»Ðµ Ð±ÑÐºÐ°Ð¿Ð°"
  trigger:
    - platform: time
      at: "03:00:00"
  action:
    - service: shelly_scripts_backup.backup_now
    - service: notify.telegram
      data:
        message: "ðŸ”’ Ð ÐµÐ·ÐµÑ€Ð²Ð½Ð¾Ðµ ÐºÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð¾Ð² Shelly Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¾ ÑƒÑÐ¿ÐµÑˆÐ½Ð¾"

# Ð•Ð¶ÐµÐ½ÐµÐ´ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð±ÑÐºÐ°Ð¿ Ñ Ð°Ñ€Ñ…Ð¸Ð²Ð°Ñ†Ð¸ÐµÐ¹
- alias: "Shelly Scripts - Weekly Backup with Archive"
  description: "Ð•Ð¶ÐµÐ½ÐµÐ´ÐµÐ»ÑŒÐ½Ñ‹Ð¹ Ð±ÑÐºÐ°Ð¿ Ñ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸ÐµÐ¼ Ð°Ñ€Ñ…Ð¸Ð²Ð°"
  trigger:
    - platform: time
      at: "01:00:00"
  condition:
    - condition: time
      weekday:
        - sun
  action:
    - service: shelly_scripts_backup.backup_now
    - service: shell_command.archive_shelly_backups

# Ð’Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° (Ð¿Ñ€Ð¸Ð¼ÐµÑ€ Ñ€ÑƒÑ‡Ð½Ð¾Ð³Ð¾ Ð·Ð°Ð¿ÑƒÑÐºÐ°)
- alias: "Shelly Scripts - Restore Script Example"
  description: "ÐŸÑ€Ð¸Ð¼ÐµÑ€ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð¸Ñ ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°"
  trigger:
    - platform: state
      entity_id: input_boolean.restore_shelly_script
      to: "on"
  action:
    - service: shelly_scripts_backup.restore_script
      data:
        device_id: "shellyplus1pm-a8032ab12345"
        script_id: 1
    - service: input_boolean.turn_off
      target:
        entity_id: input_boolean.restore_shelly_script
    - service: notify.persistent_notification
      data:
        title: "Shelly Restore"
        message: "Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð²Ð¾ÑÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ Ð¸Ð· Ñ€ÐµÐ·ÐµÑ€Ð²Ð½Ð¾Ð¹ ÐºÐ¾Ð¿Ð¸Ð¸"

# Shell command Ð´Ð»Ñ Ð°Ñ€Ñ…Ð¸Ð²Ð°Ñ†Ð¸Ð¸ (Ð´Ð¾Ð±Ð°Ð²ÑŒÑ‚Ðµ Ð² configuration.yaml)
# shell_command:
#   archive_shelly_backups: >
#     tar -czf /config/backups/shelly_scripts_$(date +%Y%m%d).tar.gz 
#     -C /config shelly_backups
